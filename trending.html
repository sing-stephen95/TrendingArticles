<?xml version="1.0" encoding="UTF-8">
<!DOCTYPE html trending SYSTEM "trending.dtd">
<html>
<head>
	<title> Trending News </title>
	<link rel = "stylesheet" type="text/css" href="style.css"/>
	<script type="text/javascript">
		function check(){
                var loc = window.location.href;
				
				//Check if proxy_format field exists
				if(loc.indexOf('proxy_format') >= 0){
					//Extract the query string
					var qString = loc.split('?');
					
					//Separate fields from query string
					var qFields = qString[1].split('&');
					
					//Get value of proxy_format. RSS or JSON
					if(qFields.indexOf('proxy_format') >= 0){
						var i = qFields.indexOf('proxy_format');
						var pfField= qFields[i].split('=');
						var proxy_format = pfField[1];
					}
				}
				else{
					var proxy_format = 'rss';
				}

                Request(proxy_format);
				
                setTimeout(check, 30000);
            
		}
		function Request(proxy_format){
			if(window.XMLHttpRequest)
			{
				xmlhttp = new XMLHttpRequest();
			}
			else
			{
				xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
			}

			xmlhttp.onreadystatechange = function()
			{
				if(xmlhttp.readyState == 4 && xmlhttp.status == 200)
				{
					 if(proxy_format=="json"){
					 }
					 else if(proxy_format=="rss"){

						document.getElementById("news").innerHTML = xmlhttp.responseText;

						//
						//document.getElementById("news").innerHTML = matches[0];
						
						request_callback_rss(xmlhttp.responseText);
						
						//parseRSS(xmlhttp.responseText);
					 }
                     
				}
			}
			
			xmlhttp.open("GET", "proxy.php" + "?f=" + proxy_format + "&q=" + enter.value + "&num=100", true); 
			
			xmlhttp.send();
		}
		
		function request_callback_rss(rss){
			document.getElementById("news").innerHTML = "CALLED";
			
			
			var word =[];
			//regex to isolate the items outputted as string by xmlhttp.responseText
			var itemtag = /<\/?[item/]+>.+<\/?[item/]+>/gi;
			var titletag = /<\/?[title/]+>.+<\/?[title/]+>/gi;
			var desctag = /<\/?[description/]+>.+<\/?[description/]+>/gi;
			//matches all substring found by regex and stores them in an array
			var title_matches = xmlhttp.responseText.match(titletag);
			var desc_matches  = xmlhttp.responseText.match(desctag);
			//alert(title_matches);
			//alert(desc_matches);
			
			//outputs (in this case) an array element to the HTML tag
			
			//Go through titles and count words
				for(var i = 0; i < title_matches.length; i++){
					var s1 = title_matches[0];
					var s3 = s1.replace(/[^a-zA-Z]/g, ' ');
					var s4 = s3.replace(/\s/g, ',');
					var s5 = s4.replace(/,+/g, ',');
					var s6 = s5.replace(/^,/, '');
					var s7 = s6.replace(/,$/, '');
					var arr = s7.split(",");
					
					for(var j = 0; j < arr.length; j++){
						if(typeof word[arr[j].toLowerCase()] !== 'number'){
							word[arr[j].toLowerCase()] = 1;
							
						}
						else{
							word[arr[j].toLowerCase()]++;
						}
					}
					
					
				}
				
				//Go through description and count words
				for(var i = 0; i < desc_matches.length; i++){
					var s1 =  desc_matches[i];
					var s3 = s1.replace(/[^a-zA-Z]/g, ' ');
					var s4 = s3.replace(/\s/g, ',');
					var s5 = s4.replace(/,+/g, ',');
					var s6 = s5.replace(/^,/, '');
					var s7 = s6.replace(/,$/, '');
					var arr = s7.split(",");
					
					for(var j = 0; j < arr.length; j++){
						if(typeof word[arr[j]] !== 'number'){
							word[arr[j].toLowerCase()] = 1;
						}
						else{
							word[arr[j].toLowerCase()]++;
						}
					}
				}
			//exclude words (from syntax parsed along with article words)
			word['title'] = 0;
			word['description'] = 0;
			word['amp'] = 0;
			word['l'] = 0;
			word['lang'] = 0;
			word['en']= 0;
			word['php'] = 0;
			word['engine'] = 0;
			word['yioop'] = 0;
			word['submitted'] = 0;
			word['comments'] = 0;
			word['link'] = 0;
			word['by'] = 0;
			word['mdash'] = 0;
			word['quot'] = 0;
			
			var out = "";
			for(var l in word){
				out+= l + "--" + word[l]+ "\n";
			}
			
			calc10(word);
			
			//document.getElementById("news").innerHTML = out;
		}
		
		function calc10(word){
			var curMaxCount = 0;
			var curMaxWord = "";
			var ten = [];
			
			for(var z = 0; z < 10; z++){
				for(var i in word){
					if(curMaxCount < word[i]){
						curMaxCount = word[i];
						curMaxWord = i;
					}
				}
				var cur = word[curMaxWord];
				ten[curMaxWord] = cur;
				word[curMaxWord] = 0;
				curMaxCount = 0;
			}
			
			for(var kk in ten){
				alert(kk + ":" + ten[kk]);
			}
		}

  	 </script>
</head>

<body onload="check()">
	<div id = "container">
		<div id = "header">
		  	<h1> Trending News </h1>
		  	<form>
		  		<label for "KeywordFilter">Keyword Filter:</label>
		  		<input id = "enter" type ="text" name="enter"> <br>
		  		<!--input type="radio" name="proxy_format" value="None" checked-->
 				<input type="radio" name="proxy_format" value="rss"> RSS
  				<input type="radio" name="proxy_format" value="json"> JSON
		  		<!--button id = "submit">Submit</button-->
		</div>

	 </div>

	 <div id="newss">
     <!--h2 id="newsLink"><a href="http://yioop.com/s/news">News</a></h2--> 
     </div>
	 <textarea readonly rows="100" cols="160" id='news'></textarea>


		<div id = "content">
			<ul>
				<li> trend 1  </li>
				<li> trend 2  </li>
				<li> trend 3  </li>
				<li> trend 4  </li>
				<li> trend 5  </li>
				<li> trend 6  </li>
				<li> trend 7  </li>
				<li> trend 8  </li>
				<li> trend 9  </li>
				<li> trend 10 </li>
			</ul>
	 	</div>

</body>
</html>
